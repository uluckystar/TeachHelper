# åµŒå¥—å‹ç¼©åŒ…ç­”æ¡ˆå¯¼å…¥åŠŸèƒ½è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

æœ¬åŠŸèƒ½å®ç°äº†å¯¹è€ƒè¯•ç³»ç»Ÿä¸­å•ä¸ªé¢˜ç›®çš„åµŒå¥—å‹ç¼©åŒ…ç­”æ¡ˆæ‰¹é‡å¯¼å…¥ã€‚æ”¯æŒä»¥ä¸‹æ–‡ä»¶ç»“æ„ï¼š

```
ç­”æ¡ˆè·¯å¾„/
â”œâ”€â”€ 2022è®¡ç§‘1ç­-å®éªŒä¸€.zip          (ç­çº§å‹ç¼©åŒ…)
â”‚   â”œâ”€â”€ 201902011312-åˆ˜äºšæ¬£.zip     (å­¦ç”Ÿå‹ç¼©åŒ…ï¼Œå­¦å·-å§“åæ ¼å¼)
â”‚   â”‚   â””â”€â”€ å®éªŒä¸€IPç½‘ç»œé€šä¿¡åŸç†_å®éªŒæŒ‡å¯¼ä¹¦.doc
â”‚   â”œâ”€â”€ 2206103327-éƒ­ä¹‰æ”¿.zip
â”‚   â”‚   â””â”€â”€ å®éªŒæŠ¥å‘Š.docx
â”‚   â””â”€â”€ ...
â”œâ”€â”€ 2022è®¡ç§‘2ç­-å®éªŒä¸€.zip
â”‚   â””â”€â”€ ...
â””â”€â”€ ...
```

## æŠ€æœ¯ç‰¹ç‚¹

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **åµŒå¥—è§£å‹**ï¼šè‡ªåŠ¨å¤„ç†ç­çº§å‹ç¼©åŒ… â†’ å­¦ç”Ÿå‹ç¼©åŒ… â†’ ç­”æ¡ˆæ–‡æ¡£çš„ä¸‰çº§ç»“æ„
- **å­¦ç”Ÿè¯†åˆ«**ï¼šä»æ–‡ä»¶åè‡ªåŠ¨è§£æå­¦å·å’Œå§“åï¼ˆæ ¼å¼ï¼š`å­¦å·-å§“å.zip`ï¼‰
- **è‡ªåŠ¨åˆ›å»ºè´¦æˆ·**ï¼šæœªæ³¨å†Œçš„å­¦ç”Ÿå°†è‡ªåŠ¨åˆ›å»ºè´¦æˆ·ï¼ˆå­¦ç”Ÿè§’è‰²ï¼Œæœªæ¿€æ´»çŠ¶æ€ï¼‰
- **å¤šæ ¼å¼æ”¯æŒ**ï¼šæ”¯æŒ DOCã€DOCXã€PDFã€TXT ç­‰å¤šç§æ–‡æ¡£æ ¼å¼
- **æ™ºèƒ½è§£æ**ï¼šå¤ç”¨ç°æœ‰çš„å­¦ä¹ é€šç­”æ¡ˆè§£æé€»è¾‘ï¼Œæ”¯æŒå¤šç§è§£æç­–ç•¥

### ğŸ”§ æŠ€æœ¯å®ç°
- **å‹ç¼©åŒ…å¤„ç†**ï¼šä½¿ç”¨ Java æ ‡å‡† ZIP APIï¼Œæ”¯æŒ UTF-8 ç¼–ç 
- **å®‰å…¨æ£€æŸ¥**ï¼šé˜²æ­¢è·¯å¾„éå†æ”»å‡»å’Œ ZIP ç‚¸å¼¹
- **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸æ•è·å’Œé”™è¯¯æŠ¥å‘Šæœºåˆ¶
- **äº‹åŠ¡ç®¡ç†**ï¼šç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼Œæ”¯æŒéƒ¨åˆ†å¤±è´¥éš”ç¦»
- **æ—¥å¿—è®°å½•**ï¼šè¯¦ç»†çš„æ“ä½œæ—¥å¿—ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥

## åç«¯å®ç°

### 1. æ ¸å¿ƒæœåŠ¡ç±»

**`NestedZipAnswerImportService`** - ä¸»è¦æœåŠ¡ç±»

```java
@Service
public class NestedZipAnswerImportService {
    
    // ä¸»å…¥å£æ–¹æ³•
    public ImportResult importNestedZipAnswersForQuestion(String answerPath, Long questionId)
    
    // æ ¸å¿ƒå¤„ç†æ–¹æ³•
    private void processClassZipFile(...)      // å¤„ç†ç­çº§å‹ç¼©åŒ…
    private void processStudentZipFile(...)    // å¤„ç†å­¦ç”Ÿå‹ç¼©åŒ…
    private StudentInfo parseStudentInfoFromFileName(...)  // è§£æå­¦ç”Ÿä¿¡æ¯
    private User findOrCreateStudent(...)      // æŸ¥æ‰¾æˆ–åˆ›å»ºå­¦ç”Ÿç”¨æˆ·
    private String extractAnswerContent(...)   // æå–ç­”æ¡ˆå†…å®¹
    private void createOrUpdateStudentAnswer(...) // åˆ›å»ºæˆ–æ›´æ–°ç­”æ¡ˆ
}
```

### 2. REST API æ¥å£

**ç«¯ç‚¹ï¼š** `POST /api/student-answers/import-nested-zip`

**å‚æ•°ï¼š**
- `answerPath` (String): ç­”æ¡ˆæ–‡ä»¶å¤¹è·¯å¾„
- `questionId` (Long): ç›®æ ‡é¢˜ç›®ID

**è¿”å›ï¼š** `ImportResult` å¯¹è±¡

```java
@PostMapping("/import-nested-zip")
public ResponseEntity<ImportResult> importNestedZipAnswers(
    @RequestParam String answerPath,
    @RequestParam Long questionId
) {
    ImportResult result = nestedZipAnswerImportService
        .importNestedZipAnswersForQuestion(answerPath, questionId);
    return ResponseEntity.ok(result);
}
```

### 3. æ•°æ®ç±»å‹

**`ImportResult`** - å¯¼å…¥ç»“æœç±»å‹

```java
public class ImportResult {
    private int successCount;      // æˆåŠŸå¯¼å…¥æ•°é‡
    private int failureCount;      // å¤±è´¥æ•°é‡
    private List<String> messages; // å¤„ç†æ¶ˆæ¯
    private List<String> errors;   // é”™è¯¯ä¿¡æ¯
    private List<String> details;  // è¯¦ç»†ä¿¡æ¯
}
```

## å‰ç«¯å®ç°

### 1. API æ¥å£

åœ¨ `frontend/src/api/answer.ts` ä¸­æ·»åŠ ï¼š

```typescript
// åµŒå¥—å‹ç¼©åŒ…ç­”æ¡ˆå¯¼å…¥
async importNestedZipAnswers(answerPath: string, questionId: number): Promise<ImportResult> {
  const response = await longTimeoutApi.post<ImportResult>(
    '/student-answers/import-nested-zip', 
    null, 
    {
      params: { answerPath, questionId }
    }
  )
  return response.data
}
```

### 2. ç±»å‹å®šä¹‰

åœ¨ `frontend/src/types/api.ts` ä¸­æ·»åŠ ï¼š

```typescript
export interface ImportResult {
  successCount: number
  failureCount: number
  messages: string[]
  errors: string[]
  details: string[]
}
```

### 3. UI ç»„ä»¶

åœ¨è€ƒè¯•ç­”æ¡ˆç®¡ç†é¡µé¢ï¼ˆ`ExamAnswersView.vue`ï¼‰ä¸­æ·»åŠ äº†æ–°çš„å¯¼å…¥ç±»å‹é€‰é¡¹ï¼š

- å¯¼å…¥ç±»å‹é€‰æ‹©ï¼šæ–‡ä»¶å¯¼å…¥ | å­¦ä¹ é€šç­”æ¡ˆ | åŸºäºæ¨¡æ¿ | **åµŒå¥—å‹ç¼©åŒ…**
- ä¸“ç”¨è¡¨å•ï¼šç­”æ¡ˆè·¯å¾„è¾“å…¥ + ç›®æ ‡é¢˜ç›®é€‰æ‹©
- ç»“æœå±•ç¤ºï¼šæˆåŠŸ/å¤±è´¥ç»Ÿè®¡ + è¯¦ç»†ä¿¡æ¯å±•ç¤º

## ä½¿ç”¨æ–¹æ³•

### 1. å‡†å¤‡æ•°æ®

ç¡®ä¿æ–‡ä»¶ç»“æ„ç¬¦åˆè¦æ±‚ï¼š
```
/path/to/answers/
â”œâ”€â”€ ç­çº§å-ä½œä¸šå.zip
â”‚   â”œâ”€â”€ å­¦å·-å§“å.zip
â”‚   â”‚   â””â”€â”€ ç­”æ¡ˆæ–‡æ¡£.(doc|docx|pdf|txt)
â”‚   â””â”€â”€ ...
â””â”€â”€ ...
```

### 2. åç«¯æ“ä½œ

**æ–¹æ³•ä¸€ï¼šç›´æ¥ API è°ƒç”¨**
```bash
curl -X POST "http://localhost:8080/api/student-answers/import-nested-zip" \
  -d "answerPath=/path/to/answers" \
  -d "questionId=1"
```

**æ–¹æ³•äºŒï¼šä½¿ç”¨æµ‹è¯•é¡µé¢**
```bash
# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
open backend/test-nested-zip-import.html
```

### 3. å‰ç«¯æ“ä½œ

1. è¿›å…¥è€ƒè¯•ç­”æ¡ˆç®¡ç†é¡µé¢
2. ç‚¹å‡»"å¯¼å…¥ç­”æ¡ˆ"æŒ‰é’®
3. é€‰æ‹©"åµŒå¥—å‹ç¼©åŒ…"å¯¼å…¥ç±»å‹
4. å¡«å†™ç­”æ¡ˆè·¯å¾„å’Œé€‰æ‹©ç›®æ ‡é¢˜ç›®
5. ç‚¹å‡»"ç¡®è®¤å¯¼å…¥"

## é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

| é”™è¯¯ç±»å‹ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|---------|---------|
| è·¯å¾„ä¸å­˜åœ¨ | ç­”æ¡ˆè·¯å¾„é”™è¯¯ | æ£€æŸ¥è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿è·¯å¾„å­˜åœ¨ |
| é¢˜ç›®ä¸å­˜åœ¨ | é¢˜ç›®IDé”™è¯¯ | ç¡®è®¤é¢˜ç›®IDåœ¨æ•°æ®åº“ä¸­å­˜åœ¨ |
| å‹ç¼©åŒ…æŸå | æ–‡ä»¶æŸåæˆ–æ ¼å¼é”™è¯¯ | é‡æ–°ç”Ÿæˆå‹ç¼©åŒ…æ–‡ä»¶ |
| å­¦å·æ ¼å¼é”™è¯¯ | æ–‡ä»¶åä¸ç¬¦åˆè§„èŒƒ | ç¡®ä¿æ–‡ä»¶åä¸º"å­¦å·-å§“å.zip"æ ¼å¼ |
| æ–‡æ¡£è§£æå¤±è´¥ | æ–‡æ¡£æ ¼å¼ä¸æ”¯æŒæˆ–æŸå | æ£€æŸ¥æ–‡æ¡£æ ¼å¼ï¼Œç¡®ä¿æ–‡ä»¶å®Œæ•´ |

### æ—¥å¿—æŸ¥çœ‹

åœ¨åº”ç”¨æ—¥å¿—ä¸­æŸ¥æ‰¾ç›¸å…³ä¿¡æ¯ï¼š
```bash
tail -f logs/application.log | grep "NestedZipAnswerImport"
```

## æµ‹è¯•éªŒè¯

### 1. ç¼–è¯‘éªŒè¯

```bash
cd backend
mvn clean compile -DskipTests
# ç»“æœï¼šBUILD SUCCESS
```

### 2. åŠŸèƒ½æµ‹è¯•

ä½¿ç”¨æä¾›çš„æµ‹è¯•é¡µé¢ `test-nested-zip-import.html` è¿›è¡ŒåŠŸèƒ½éªŒè¯ã€‚

### 3. é›†æˆæµ‹è¯•

1. å¯åŠ¨åç«¯æœåŠ¡
2. å‡†å¤‡æµ‹è¯•æ•°æ®ï¼ˆæŒ‰è¦æ±‚çš„æ–‡ä»¶ç»“æ„ï¼‰
3. è°ƒç”¨APIæ¥å£
4. éªŒè¯æ•°æ®åº“ä¸­çš„ç­”æ¡ˆè®°å½•

## æ€§èƒ½è€ƒè™‘

- **å†…å­˜ç®¡ç†**ï¼šä½¿ç”¨ä¸´æ—¶ç›®å½•å¤„ç†å¤§æ–‡ä»¶ï¼Œè‡ªåŠ¨æ¸…ç†
- **å¹¶å‘å®‰å…¨**ï¼šæ”¯æŒå¤šç”¨æˆ·åŒæ—¶å¯¼å…¥
- **äº‹åŠ¡å¤„ç†**ï¼šéƒ¨åˆ†å¤±è´¥ä¸å½±å“å·²æˆåŠŸçš„è®°å½•
- **è¶…æ—¶è®¾ç½®**ï¼šå‰ç«¯ä½¿ç”¨ `longTimeoutApi` å¤„ç†é•¿æ—¶é—´æ“ä½œ

## æ‰©å±•æ€§

è¯¥åŠŸèƒ½è®¾è®¡å…·æœ‰è‰¯å¥½çš„æ‰©å±•æ€§ï¼š

1. **æ–‡ä»¶æ ¼å¼**ï¼šå¯è½»æ¾æ·»åŠ æ–°çš„æ–‡æ¡£æ ¼å¼æ”¯æŒ
2. **è§£æç­–ç•¥**ï¼šå¯é…ç½®ä¸åŒçš„æ–‡æ¡£è§£ææ–¹æ³•
3. **æ–‡ä»¶ç»“æ„**ï¼šå¯æ‰©å±•æ”¯æŒä¸åŒçš„å‹ç¼©åŒ…ç»“æ„
4. **æ‰¹å¤„ç†**ï¼šå¯æ‰©å±•ä¸ºå¼‚æ­¥æ‰¹å¤„ç†æ¨¡å¼

## éƒ¨ç½²è¯´æ˜

1. ç¡®ä¿åç«¯æœåŠ¡åŒ…å«äº†æ‰€æœ‰å¿…è¦çš„ä¾èµ–
2. é…ç½®è¶³å¤Ÿçš„ä¸´æ—¶ç›®å½•ç©ºé—´
3. è®¾ç½®åˆé€‚çš„è¶…æ—¶å‚æ•°
4. é…ç½®æ—¥å¿—çº§åˆ«ä»¥ä¾¿é—®é¢˜æ’æŸ¥

---

**å¼€å‘å®Œæˆæ—¶é—´ï¼š** 2025å¹´7æœˆ2æ—¥  
**åŠŸèƒ½çŠ¶æ€ï¼š** âœ… åç«¯å®Œæˆå¹¶é€šè¿‡ç¼–è¯‘éªŒè¯  
**æµ‹è¯•çŠ¶æ€ï¼š** âœ… æä¾›å®Œæ•´æµ‹è¯•é¡µé¢  
**æ–‡æ¡£çŠ¶æ€ï¼š** âœ… å®Œæ•´åŠŸèƒ½è¯´æ˜æ–‡æ¡£ 