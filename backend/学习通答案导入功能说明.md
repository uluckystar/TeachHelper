# 学习通答案导入功能说明

## 功能概述

本功能完善了学生答案导入系统，新增了学习通答案的自动解析和导入功能，同时支持自动创建未注册的学生用户。

## 主要功能

### 1. 传统文件导入功能完善
- 支持Excel (.xlsx/.xls) 和 CSV 格式文件导入
- 模板格式：学生姓名、学号、题目ID、答案内容
- 自动创建未注册学生用户（标记为未激活状态）

### 2. 学习通答案导入功能
- 自动解析学习通Word文档格式的答案
- 支持批量导入多个班级的答案
- 自动识别学生信息（姓名、学号、学院、专业等）
- 自动解析题目和答案内容

## 文件结构支持

系统支持以下文件夹结构：
```uploads/answer/
├── 路由与交换技术/
│   ├── 2022计科1班-考试名称(word)/
│   │   ├── miniprogram1166115562438104-段志贤-考试名称.doc
│   │   ├── 大数据与基础科学学院-计算机类-计算机类2022-2206181018-冯华睿-考试名称.doc
│   │   └── ...
│   ├── 2022计科2班-考试名称(word)/
│   └── ...
└── 其他科目/
```

## 文件名格式支持

### 格式1: miniprogram格式
```
miniprogram1166115562438104-段志贤-2024-2025-2《路由与交换技术》期末考试--A卷.doc
```

### 格式2: 完整学院信息格式
```
大数据与基础科学学院-计算机类-计算机类2022-2206181018-冯华睿-2024-2025-2《路由与交换技术》期末考试--A卷.doc
```

### 格式3: 简化格式
```
计算机科学与技术2022-202006015120-宋家宝.doc
```

## 答案解析功能

系统自动解析Word文档内容，支持以下题目编号格式：
- 数字格式：1. 2. 3. 或 1、2、3、
- 中文格式：一、二、三、
- 括号格式：(1) (2) (3)

## 学生用户自动创建

当导入的学生不存在时，系统会自动创建学生账户：
- 使用学号作为用户名（如无学号则使用姓名+时间戳）
- 生成临时邮箱地址
- 设置默认密码（需要学生激活后修改）
- 标记为未激活状态
- 自动设置学生角色
- 保存学院、专业、班级等扩展信息

## API接口

### 1. 获取可用科目列表
```
GET /api/student-answers/learning/subjects
```

### 2. 获取科目下的班级列表
```
GET /api/student-answers/learning/subjects/{subject}/classes
```

### 3. 导入学习通答案
```
POST /api/student-answers/import/learning
参数：
- subject: 科目名称
- classFolders: 班级文件夹列表（可多选）
```

### 4. 传统文件导入
```
POST /api/student-answers/import/exam/{examId}
参数：
- file: 上传的Excel/CSV文件
```

## 前端界面改进

### 导入类型选择
- 文件导入：传统Excel/CSV文件上传
- 学习通答案：从文件夹批量导入

### 学习通导入流程
1. 选择导入类型为"学习通答案"
2. 选择科目（自动加载可用科目列表）
3. 选择要导入的班级（支持多选）
4. 确认导入

## 配置要求

### 后端配置
在 `application.yml` 中确保配置了正确的上传目录：
```yaml
app:
  upload:
    dir: ${UPLOAD_DIR:/path/to/uploads}
```

### 文件权限
确保应用程序对上传目录有读写权限。

## 注意事项

1. **文件编码**: Word文档应使用UTF-8编码以避免中文乱码
2. **文件大小**: 单个文件不超过10MB
3. **批量导入**: 建议分批次导入大量文件，避免超时
4. **用户激活**: 自动创建的学生用户需要管理员激活或学生自行激活
5. **题目匹配**: 当前版本题目匹配逻辑需要根据实际需求进一步完善

## 错误处理

系统提供详细的错误信息反馈：
- 文件格式不支持
- 文件解析失败
- 学生信息无法识别
- 题目匹配失败
- 数据库保存错误

## 日志记录

系统记录详细的导入日志：
- 解析的文档数量
- 创建的新用户信息
- 导入的答案数量
- 错误和警告信息

这些日志有助于故障排除和数据审计。 