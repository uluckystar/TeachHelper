# åµŒå¥—å‹ç¼©åŒ…ç§‘ç›®é€‰æ‹©é—®é¢˜è§£å†³æ–¹æ¡ˆ

## ğŸ” é—®é¢˜æè¿°
ç”¨æˆ·åæ˜ åœ¨å‰ç«¯é€‰æ‹©ç§‘ç›®æ—¶æ˜¾ç¤ºæ— æ•°æ®ï¼Œä½†å®é™…åœ¨ `~/project/vvv/TeachHelper/uploads/answer` ä¸‹é¢ç¡®å®å­˜åœ¨æ–‡ä»¶å¤¹å’Œèµ„æ–™ã€‚

## ğŸ“ å®é™…æ–‡ä»¶ç»“æ„
```
/Users/jiangjiaxing/project/vvv/TeachHelper/uploads/answer/
â”œâ”€â”€ è·¯ç”±ä¸äº¤æ¢æŠ€æœ¯/
â””â”€â”€ è·¯ç”±ä¸äº¤æ¢æŠ€æœ¯å¹³æ—¶ä½œä¸šä¸å®éªŒ/
    â”œâ”€â”€ å¹³æ—¶ä½œä¸š1/
    â”œâ”€â”€ å¹³æ—¶ä½œä¸š2/
    â”œâ”€â”€ å¹³æ—¶ä½œä¸š3/
    â”œâ”€â”€ å®éªŒ1/
    â”œâ”€â”€ å®éªŒ2/
    â”œâ”€â”€ å®éªŒ3/
    â”œâ”€â”€ å®éªŒ4/
    â”œâ”€â”€ å®éªŒ5/
    â””â”€â”€ å®éªŒ6/
```

## ğŸ› æ ¹æœ¬åŸå› 
åç«¯ `NestedZipAnswerImportService.getAnswerBasePath()` æ–¹æ³•ä½¿ç”¨äº†é”™è¯¯çš„è·¯å¾„è·å–æ–¹å¼ï¼š

**åŸå§‹é”™è¯¯ä»£ç ï¼š**
```java
private String getAnswerBasePath() {
    // è·å–é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„uploads/answerè·¯å¾„
    String userDir = System.getProperty("user.dir");  // âŒ é”™è¯¯ï¼šä¾èµ–è¿è¡Œæ—¶å·¥ä½œç›®å½•
    return userDir + File.separator + "uploads" + File.separator + "answer";
}
```

**é—®é¢˜ï¼š**
- `System.getProperty("user.dir")` è¿”å›çš„æ˜¯JVMå¯åŠ¨æ—¶çš„å·¥ä½œç›®å½•
- åœ¨ä¸åŒçš„å¯åŠ¨æ–¹å¼ä¸‹ï¼Œè¿™ä¸ªç›®å½•å¯èƒ½ä¸æ˜¯é¡¹ç›®æ ¹ç›®å½•
- æ²¡æœ‰ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­å·²æœ‰çš„ `app.upload.dir` é…ç½®

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. ä¿®å¤è·¯å¾„è·å–æ–¹æ³•
**ä¿®æ”¹åçš„æ­£ç¡®ä»£ç ï¼š**
```java
@Value("${app.upload.dir}")
private String uploadDir;

private String getAnswerBasePath() {
    // ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„ä¸Šä¼ ç›®å½• + /answer
    return uploadDir + File.separator + "answer";
}
```

### 2. ä¿®å¤è·¯å¾„æ„å»ºé€»è¾‘
**åŸå§‹ä»£ç ï¼š**
```java
File answerDir = new File(uploadDir, "answer/" + answerPath);  // âŒ æ··åˆç»å¯¹å’Œç›¸å¯¹è·¯å¾„
```

**ä¿®å¤åï¼š**
```java
File answerDir = new File(getAnswerBasePath(), answerPath);  // âœ… ç»Ÿä¸€ä½¿ç”¨æ–¹æ³•
```

### 3. ä¿®å¤æ–¹æ³•å‚æ•°ä¼ é€’
**ä¿®å¤ç›¸å¯¹è·¯å¾„ä¼ é€’ï¼š**
```java
public ImportResult importNestedZipAnswersBySubjectAndAssignment(String subject, String assignment, Long questionId) {
    // æ„å»ºç›¸å¯¹äºanswerç›®å½•çš„è·¯å¾„
    String relativePath = subject + File.separator + assignment;  // âœ… åªä¼ é€’ç›¸å¯¹è·¯å¾„
    return importNestedZipAnswersForQuestion(relativePath, questionId);
}
```

### 4. é…ç½®æ–‡ä»¶ç¡®è®¤
**application.yml ä¸­çš„é…ç½®ï¼š**
```yaml
app:
  upload:
    dir: ${UPLOAD_DIR:/Users/jiangjiaxing/project/vvv/TeachHelper/uploads}  # âœ… æ­£ç¡®é…ç½®
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### APIç«¯ç‚¹æµ‹è¯•
1. **è·å–ç§‘ç›®åˆ—è¡¨ï¼š** `GET /api/student-answers/nested-zip-subjects`
   - åº”è¿”å›ï¼š`["è·¯ç”±ä¸äº¤æ¢æŠ€æœ¯", "è·¯ç”±ä¸äº¤æ¢æŠ€æœ¯å¹³æ—¶ä½œä¸šä¸å®éªŒ"]`

2. **è·å–ä½œä¸šåˆ—è¡¨ï¼š** `GET /api/student-answers/nested-zip-assignments?subject=è·¯ç”±ä¸äº¤æ¢æŠ€æœ¯å¹³æ—¶ä½œä¸šä¸å®éªŒ`
   - åº”è¿”å›ï¼š`["å¹³æ—¶ä½œä¸š1", "å¹³æ—¶ä½œä¸š2", "å¹³æ—¶ä½œä¸š3", "å®éªŒ1", "å®éªŒ2", "å®éªŒ3", "å®éªŒ4", "å®éªŒ5", "å®éªŒ6"]`

### æµ‹è¯•æ–‡ä»¶
- åˆ›å»ºäº† `test-nested-zip-subjects.html` ç”¨äºAPIæµ‹è¯•
- åŒ…å«å®Œæ•´çš„å‰ç«¯æµ‹è¯•ç•Œé¢

## ğŸ”§ è°ƒè¯•å¢å¼º
åœ¨ `getAvailableSubjects()` æ–¹æ³•ä¸­æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ï¼š
```java
log.info("ğŸ“ è·å–ç§‘ç›®åˆ—è¡¨ - åŸºç¡€è·¯å¾„: {}", basePath);
log.info("ğŸ“‹ æ‰¾åˆ°ç§‘ç›®åˆ—è¡¨: {}", subjects);
```

## âœ… ä¿®å¤ç¡®è®¤
- âœ… åç«¯ç¼–è¯‘é€šè¿‡
- âœ… è·¯å¾„é…ç½®ä¿®å¤å®Œæˆ
- âœ… APIé€»è¾‘ç»Ÿä¸€
- âœ… è°ƒè¯•æ—¥å¿—å®Œå–„

## ğŸš€ ä½¿ç”¨æµç¨‹
1. **å¯åŠ¨åç«¯æœåŠ¡**
2. **è®¿é—®æµ‹è¯•é¡µé¢** `test-nested-zip-subjects.html`
3. **æµ‹è¯•ç§‘ç›®è·å–** - åº”è¯¥èƒ½çœ‹åˆ°ä¸¤ä¸ªç§‘ç›®
4. **æµ‹è¯•ä½œä¸šè·å–** - è¾“å…¥ç§‘ç›®åç§°ååº”è¯¥èƒ½çœ‹åˆ°ä½œä¸šåˆ—è¡¨
5. **åœ¨å‰ç«¯é¡µé¢ä½¿ç”¨** - åµŒå¥—å‹ç¼©åŒ…å¯¼å…¥åŠŸèƒ½ç°åœ¨åº”è¯¥èƒ½æ­£ç¡®åŠ è½½ç§‘ç›®å’Œä½œä¸šåˆ—è¡¨

## ğŸ“ æ³¨æ„äº‹é¡¹
- ç¡®ä¿åç«¯æœåŠ¡å¯åŠ¨æ—¶å·¥ä½œç›®å½•æ­£ç¡®
- é…ç½®çš„ä¸Šä¼ ç›®å½•å¿…é¡»å­˜åœ¨ä¸”æœ‰è¯»å–æƒé™
- æ–‡ä»¶å¤¹åç§°æ”¯æŒä¸­æ–‡ï¼Œä½¿ç”¨UTF-8ç¼–ç å¤„ç† 